{"version":3,"file":"index.umd.js","sources":["src/index.js"],"sourcesContent":["import { Controller } from \"stimulus\"\nimport Tribute from \"tributejs\"\nimport Trix from \"trix\"\n\nexport default class extends Controller {\n  static targets = [\"field\"]\n\n  connect() {\n    this.editor = this.fieldTarget.editor\n    this.initializeTribute()\n  }\n\n  disconnect() {\n    this.tribute.detach(this.fieldTarget)\n  }\n\n  initializeTribute() {\n    this.tribute = new Tribute({\n      allowSpaces: true,\n      lookup: 'name',\n      values: this.fetchUsers,\n    })\n    this.tribute.attach(this.fieldTarget)\n    this.tribute.range.pasteHtml = this._pasteHtml.bind(this)\n    this.fieldTarget.addEventListener(\"tribute-replaced\", this.replaced)\n  }\n\n  fetchUsers(text, callback) {\n    fetch(`/mentions.json?query=${text}`)\n      .then(response => response.json())\n      .then(users => callback(users))\n      .catch(error => callback([]))\n  }\n\n  replaced(e) {\n    let mention = e.detail.item.original\n    let attachment = new Trix.Attachment({\n      sgid: mention.sgid,\n      content: mention.content\n    })\n    this.editor.insertAttachment(attachment)\n    this.editor.insertString(\" \")\n  }\n\n  _pasteHtml(html, startPos, endPos) {\n    let position = this.editor.getPosition()\n    this.editor.setSelectedRange([position - endPos, position])\n    this.editor.deleteInDirection(\"backward\")\n  }\n}"],"names":["connect","editor","this","fieldTarget","initializeTribute","disconnect","tribute","detach","Tribute","allowSpaces","lookup","values","fetchUsers","attach","range","pasteHtml","_pasteHtml","bind","addEventListener","replaced","text","callback","fetch","then","response","json","users","catch","error","e","mention","detail","item","original","attachment","Trix","Attachment","sgid","content","insertAttachment","insertString","html","startPos","endPos","position","getPosition","setSelectedRange","deleteInDirection","Controller","targets"],"mappings":"kYAIe,uJAGbA,wBACOC,OAASC,KAAKC,YAAYF,YAC1BG,iCAGPC,2BACOC,QAAQC,OAAOL,KAAKC,0BAG3BC,kCACOE,QAAU,IAAIE,EAAQ,CACzBC,aAAa,EACbC,OAAQ,OACRC,OAAQT,KAAKU,kBAEVN,QAAQO,OAAOX,KAAKC,kBACpBG,QAAQQ,MAAMC,UAAYb,KAAKc,WAAWC,KAAKf,WAC/CC,YAAYe,iBAAiB,mBAAoBhB,KAAKiB,uBAG7DP,oBAAWQ,EAAMC,GACfC,8BAA8BF,GAC3BG,cAAKC,UAAYA,EAASC,SAC1BF,cAAKG,UAASL,EAASK,KACvBC,eAAMC,UAASP,EAAS,mBAG7BF,kBAASU,OACHC,EAAUD,EAAEE,OAAOC,KAAKC,SACxBC,EAAa,IAAIC,EAAKC,WAAW,CACnCC,KAAMP,EAAQO,KACdC,QAASR,EAAQQ,eAEdrC,OAAOsC,iBAAiBL,QACxBjC,OAAOuC,aAAa,kBAG3BxB,oBAAWyB,EAAMC,EAAUC,OACrBC,EAAW1C,KAAKD,OAAO4C,mBACtB5C,OAAO6C,iBAAiB,CAACF,EAAWD,EAAQC,SAC5C3C,OAAO8C,kBAAkB,gBA3CLC,uBACpBC,QAAU,CAAC"}