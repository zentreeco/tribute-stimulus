import{Controller as t}from"stimulus";import e from"tributejs";import i from"trix";var r=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),(r.prototype=Object.create(t&&t.prototype)).constructor=r,r.prototype.connect=function(){this.editor=this.fieldTarget.editor,this.initializeTribute()},r.prototype.disconnect=function(){this.tribute.detach(this.fieldTarget)},r.prototype.initializeTribute=function(){this.tribute=new e({allowSpaces:!0,lookup:"name",values:this.fetchUsers}),this.tribute.attach(this.fieldTarget),this.tribute.range.pasteHtml=this._pasteHtml.bind(this),this.fieldTarget.addEventListener("tribute-replaced",this.replaced)},r.prototype.fetchUsers=function(t,e){fetch("/mentions.json?query="+t).then(function(t){return t.json()}).then(function(t){return e(t)}).catch(function(t){return e([])})},r.prototype.replaced=function(t){var e=t.detail.item.original,r=new i.Attachment({sgid:e.sgid,content:e.content});this.editor.insertAttachment(r),this.editor.insertString(" ")},r.prototype._pasteHtml=function(t,e,i){var r=this.editor.getPosition();this.editor.setSelectedRange([r-i,r]),this.editor.deleteInDirection("backward")},r}(t);r.targets=["field"];export default r;
//# sourceMappingURL=index.mjs.map
